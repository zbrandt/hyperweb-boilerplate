{
  "version": 3,
  "sources": ["../../src/reputation-contract/sdk.ts", "../../src/reputation-contract/reputation.ts", "../../src/reputation-contract/index.ts"],
  "sourcesContent": ["import { MappingStore, State, Store } from \"./types\";\n\nexport function useStore<ValueType>(key: string, defaultValue: ValueType): Store<ValueType> {\n  return (state: State) => [\n    () => state.get(key) ?? defaultValue,\n    (value: ValueType) => state.set(key, value)\n  ]\n}\n\nexport function useMapping<Params extends any[], ValueType>(keys: string[], defaultValue: ValueType): MappingStore<Params, ValueType> {\n  return (state: State) => [\n    (...args: Params) => {\n      // assert: keys.length === args.length + 1\n      const interleavedKey = [keys[0]];\n      const pathKeys = keys.slice(1);\n      for(let i = 0; i < pathKeys.length; i++) {\n        interleavedKey.push(pathKeys[i], args[i]);\n      }\n      return state.get(interleavedKey.join('/')) ?? defaultValue;\n    },\n    (...args: [...Params, ValueType]) => {\n      const interleavedKey = [keys[0]];\n      const pathKeys = keys.slice(1);\n      const keyArgs = args.slice(0, -1) as Params;\n      for(let i = 0; i < pathKeys.length; i++) {\n        interleavedKey.push(pathKeys[i], keyArgs[i]);\n      }\n      state.set(interleavedKey.join('/'), args[args.length - 1]);\n    }\n  ]\n}\n", "import { useMapping, useStore } from './sdk';\nimport { MappingStore, Msg, State, Store } from './types';\n\nconst admin: Store<string> = useStore('admin', '');\nconst users: MappingStore<[string], User> = useMapping(['address'], {\n    address: \"\",\n    score: 0,\n    registered: false as boolean\n});\n\ninterface User {\n    address: string;\n    score: number;\n    registered: boolean;\n}\n\nexport class Contract {\n    msg: Msg;\n    address: string;\n    admin;\n    setAdmin;\n    users;\n    setUsers;\n\n    constructor(state: State, {msg, address}: {msg: Msg, address: string}) {\n        this.msg = msg;\n        this.address = address;\n\n        [this.admin, this.setAdmin] = admin(state);\n        [this.users, this.setUsers] = users(state);\n        this.setAdmin(msg.sender);\n    }\n\n    getAdmin(): string {\n        return this.admin();\n    }\n\n    getUser(address: string): User {\n        return this.users(address);\n    }\n\n    registerUser({address}: {address: string}): string {\n        if (this.users(address).registered) {\n            throw Error(\"user already registered\");\n        }\n        const newUser: User = {\n            address: address,\n            score: 500, // initial credit score\n            registered: true\n        };\n        this.setUsers(address, newUser);\n        return address;\n    }\n\n    adjustScore({address, score}: {address: string, score: number}): User {\n        if (!this.users(address).registered) {\n            throw Error(\"user not registered\");\n        }\n        this.setUsers(address, {address: address, score: score, registered: true});\n        return this.users(address);\n    }\n\n    evaluateUser({address, change}: {address: string, change: number}): User {\n        if (!this.users(address).registered) {\n            throw Error(\"user not registered\");\n        }\n        const user = this.users(address);\n        const newScore = user.score + change;\n        if (newScore < 0) {\n            throw Error(\"score cannot be negative\");\n        }\n        this.setUsers(address, {address: address, score: newScore, registered: true});\n        return this.users(address);\n    }\n}", "export * from './reputation'\nexport * from './sdk'\nexport * from './types'\n\nimport { Contract } from './reputation'\n\nexport default Contract;  // need to explicitly export Contract to make it the entry point\n"],
  "mappings": "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",
  "names": []
}
